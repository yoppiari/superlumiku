# ============================================
# LUMIKU APP - COOLIFY PRODUCTION ENVIRONMENT
# ============================================
# This template contains all required environment variables for Coolify deployment
#
# SETUP INSTRUCTIONS:
# 1. Copy this file to .env in your Coolify environment settings
# 2. Replace all placeholder values marked with [REQUIRED] or [GENERATE]
# 3. Verify PostgreSQL and Redis connection details from Coolify services
# 4. Never commit this file with real secrets to version control

# ============================================
# DATABASE CONFIGURATION (Coolify PostgreSQL)
# ============================================
# REQUIRED: Get these values from Coolify PostgreSQL service
DATABASE_URL="postgresql://[COOLIFY_POSTGRES_USER]:[COOLIFY_POSTGRES_PASSWORD]@[COOLIFY_POSTGRES_HOST]:5432/lumiku-prod?schema=public"
POSTGRES_HOST="[COOLIFY_POSTGRES_HOST]"
POSTGRES_USER="[COOLIFY_POSTGRES_USER]"
POSTGRES_PASSWORD="[COOLIFY_POSTGRES_PASSWORD]"
POSTGRES_DB="lumiku-prod"

# ============================================
# JWT CONFIGURATION - CRITICAL SECURITY
# ============================================
# GENERATE NEW SECRET: Run this command to generate secure JWT secret
#   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# SECURITY REQUIREMENTS:
# - MUST be unique per environment (production, staging, dev)
# - Minimum 64 characters (cryptographically random)
# - NEVER reuse secrets across environments
# - Rotate every 90 days in production

# [GENERATE] - Generated secure example (DO NOT USE THIS IN PRODUCTION):
# JWT_SECRET="d9dc3c119e1e18a83cd2f7fefe668c3a2cd33044ab62e3c8e3df03c045f65baf"
JWT_SECRET="[GENERATE_YOUR_OWN_64_CHAR_SECRET]"
JWT_EXPIRES_IN="7d"

# ============================================
# SERVER CONFIGURATION
# ============================================
PORT=3000
NODE_ENV="production"

# ============================================
# REDIS CONFIGURATION (Coolify Redis)
# ============================================
# REQUIRED: Get these values from Coolify Redis service
# Redis is used for background job queues, caching, and rate limiting

# [GENERATE] Redis Password: Run this command to generate secure password
#   node -e "console.log(require('crypto').randomBytes(16).toString('hex'))"
#
# Generated secure example (DO NOT USE THIS IN PRODUCTION):
# REDIS_PASSWORD="f989e8b921f0db295f1ee0f71b8461d7"

REDIS_HOST="[COOLIFY_REDIS_HOST]"
REDIS_PORT="6379"
REDIS_PASSWORD="[GENERATE_YOUR_OWN_32_CHAR_PASSWORD]"
REDIS_ENABLED="true"

# ============================================
# PAYMENT GATEWAY (DUITKU)
# ============================================
# REQUIRED: Contact Duitku for production credentials
# Sandbox credentials provided below for testing only

# PRODUCTION - Replace with real credentials from Duitku
DUITKU_MERCHANT_CODE="[REQUIRED_DUITKU_MERCHANT_CODE]"
DUITKU_API_KEY="[REQUIRED_DUITKU_API_KEY]"
DUITKU_ENV="production"
DUITKU_CALLBACK_URL="https://lumiku.com/api/mainapp/payment/callback"
DUITKU_RETURN_URL="https://lumiku.com"

# SANDBOX (for testing) - Can use these initially
# DUITKU_MERCHANT_CODE="DS25180"
# DUITKU_API_KEY="55e33f1d71cc5ed5ce8b5abab54fc7ae"
# DUITKU_ENV="sandbox"

# ============================================
# AI SERVICES - CRITICAL FOR FUNCTIONALITY
# ============================================
# REQUIRED: Generate API keys from respective platforms

# Hugging Face API Key (REQUIRED)
# Generate at: https://huggingface.co/settings/tokens
# Used for: Avatar Creator, Pose Generator, AI model inference
# Permissions needed: Read access to models
HUGGINGFACE_API_KEY="[REQUIRED_HUGGINGFACE_API_KEY]"

# Anthropic API Key (Optional - for AI assistant features)
# Generate at: https://console.anthropic.com/
ANTHROPIC_API_KEY="[OPTIONAL_ANTHROPIC_API_KEY]"

# Eden AI API Key (Optional - for premium video generation)
# Generate at: https://app.edenai.run/admin/account/settings
EDENAI_API_KEY="[OPTIONAL_EDENAI_API_KEY]"

# ============================================
# AI MODEL CONFIGURATION
# ============================================
# Avatar Creator Models
AVATAR_MODEL="black-forest-labs/FLUX.1-dev"
AVATAR_LORA_MODEL="XLabs-AI/flux-RealismLora"

# Pose Generator Models
CONTROLNET_MODEL_SD="lllyasviel/control_v11p_sd15_openpose"
CONTROLNET_MODEL_HD="thibaud/controlnet-openpose-sdxl-1.0"
SDXL_MODEL="stabilityai/stable-diffusion-xl-base-1.0"
INPAINTING_MODEL="runwayml/stable-diffusion-inpainting"
BACKGROUND_MODEL="stabilityai/stable-diffusion-xl-base-1.0"

# ============================================
# STORAGE CONFIGURATION
# ============================================
# Storage mode: 'local' for filesystem, 'r2' for Cloudflare R2
# Start with 'local', migrate to 'r2' for scalability
STORAGE_MODE="local"

# Local storage path (requires persistent volume in Coolify)
UPLOAD_PATH="/app/backend/uploads"
AVATAR_STORAGE_PATH="/app/backend/uploads/avatars"
POSE_OUTPUT_PATH="/app/backend/uploads/pose-generator"
UPLOAD_DIR="/app/backend/uploads"
OUTPUT_DIR="/app/backend/uploads/outputs"

# File size limits (in bytes)
MAX_FILE_SIZE=524288000
MAX_AVATAR_SIZE_MB=10
MAX_PRODUCT_SIZE_MB=20

# ============================================
# CLOUDFLARE R2 (Optional - Future Migration)
# ============================================
# Only required when STORAGE_MODE=r2
R2_ACCOUNT_ID=""
R2_ACCESS_KEY_ID=""
R2_SECRET_ACCESS_KEY=""
R2_BUCKET_NAME="lumiku-poses"
R2_PUBLIC_URL=""

# ============================================
# CORS CONFIGURATION
# ============================================
# REQUIRED: Update with your actual frontend domain
CORS_ORIGIN="https://lumiku.com"

# ============================================
# RATE LIMITING (Security)
# ============================================
RATE_LIMIT_ENABLED="true"
RATE_LIMIT_WINDOW_MS="900000"
RATE_LIMIT_MAX_REQUESTS="100"

# Login rate limits (IP-based)
RATE_LIMIT_LOGIN_WINDOW_MS="900000"
RATE_LIMIT_LOGIN_MAX_ATTEMPTS="5"

# Registration rate limits
RATE_LIMIT_REGISTER_WINDOW_MS="3600000"
RATE_LIMIT_REGISTER_MAX_ATTEMPTS="3"

# Password reset rate limits
RATE_LIMIT_PASSWORD_RESET_WINDOW_MS="3600000"
RATE_LIMIT_PASSWORD_RESET_MAX_ATTEMPTS="3"

# Profile update rate limits
RATE_LIMIT_PROFILE_UPDATE_WINDOW_MS="3600000"
RATE_LIMIT_PROFILE_UPDATE_MAX_ATTEMPTS="10"

# Account lockout settings
RATE_LIMIT_ACCOUNT_LOCKOUT_ATTEMPTS="10"
RATE_LIMIT_ACCOUNT_LOCKOUT_DURATION_MS="1800000"

# Global rate limits
RATE_LIMIT_GLOBAL_AUTH_WINDOW_MS="60000"
RATE_LIMIT_GLOBAL_AUTH_MAX_REQUESTS="1000"

# ============================================
# WORKER CONFIGURATION
# ============================================
WORKER_CONCURRENCY="5"
WORKER_NAME="pose-generator-worker-prod"

# AI Processing Timeouts
HF_API_TIMEOUT="120000"
POSE_GENERATION_TIMEOUT="180"
MAX_POSES_PER_GENERATION="100"

# ============================================
# FEATURE FLAGS
# ============================================
ENABLE_CONTROLNET="true"
ENABLE_TEXT_TO_AVATAR="true"
ENABLE_FASHION_ENHANCEMENT="true"
ENABLE_BACKGROUND_REPLACEMENT="true"
ENABLE_PROFESSION_THEMES="true"

# ============================================
# FFMPEG CONFIGURATION
# ============================================
# FFmpeg paths (usually available in PATH in production)
FFMPEG_PATH="ffmpeg"
FFPROBE_PATH="ffprobe"

# ============================================
# SETUP CHECKLIST
# ============================================
# Before deployment, ensure you have:
#
# [REQUIRED] 1. Generated unique JWT_SECRET (64 chars minimum)
# [REQUIRED] 2. Generated secure REDIS_PASSWORD (32 chars minimum)
# [REQUIRED] 3. Obtained HUGGINGFACE_API_KEY from https://huggingface.co/settings/tokens
# [REQUIRED] 4. Updated DATABASE_URL with Coolify PostgreSQL connection details
# [REQUIRED] 5. Updated REDIS_HOST with Coolify Redis service host
# [REQUIRED] 6. Updated CORS_ORIGIN with your production domain
# [REQUIRED] 7. Configured persistent volume for /app/backend/uploads in Coolify
#
# [RECOMMENDED] 8. Obtained Duitku production credentials for payments
# [OPTIONAL] 9. Obtained ANTHROPIC_API_KEY for AI assistant features
# [OPTIONAL] 10. Obtained EDENAI_API_KEY for premium video generation
#
# DEPLOYMENT STEPS:
# 1. Copy this file to Coolify environment variables (without .template extension)
# 2. Replace all [REQUIRED], [GENERATE], and [COOLIFY_*] placeholders
# 3. Run database migrations (see COOLIFY_MIGRATION_COMMANDS.md)
# 4. Run seed file to populate AI models (see COOLIFY_MIGRATION_COMMANDS.md)
# 5. Test health endpoint: https://your-domain.com/api/health
# 6. Verify Redis connection and background workers
# 7. Test avatar creation and pose generation features
